const mongoose = require('mongoose');
const { Schema } = mongoose;

// Definición de las opciones
const SUCURSAL_OPTIONS = Object.freeze([
    "Casa Matriz",
    "Sucursal Puerto Montt",
    "Sucursal Antofagasta",
    "Sucursal Talca",
    "Sucursal Centro Puerto",
    "Sucursal Cambio y Soluciones (Peru)",
    "Sucursal Valparaiso",
    "Sucursal Copiapó",
]);

const AREA_OPTIONS = Object.freeze([
    "GERENCIA COMERCIAL",
    "GERENCIA DE CAMIONES",
    "GERENCIA ADM. Y FINANZAS",
    "GERENCIA POST VENTA ",
    "GERENCIA REPUESTOS",
    "GERENCIA OPERACIONES",
]);

const ROL_OPTIONS = Object.freeze([
    "admin",
    "gerente",
    "jefe",
    "vendedor",
    "tecnico",
    "usuarioGeneral",
]);

const UsuariosCASchema = new Schema({
    usuario: {
        type: String,
        required: true,
        unique: true,             
        trim: true,
        lowercase: true,
        minlength: 4
    },
    pnombre: {
        type: String,
        required: true,
        trim: true
    },
    snombre: {
        type: String,
        required: false,          
        trim: true
    },
    papellido: {
        type: String,
        required: true,
        trim: true
    },
    sapellido: {
        type: String,
        required: false,          
        trim: true
    },
    password: {
        type: String,
        required: true,
        select: false,            
        minlength: 6
    },
    email: {
        type: String,
        required: true,
        unique: true,            
        trim: true,
        lowercase: true,
        match: [/^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$/, 'Por favor, introduce un email válido']
    },
    sucursal: {
        type: String,
        required: true,
        enum: SUCURSAL_OPTIONS    
    },
    area: {
        type: String,
        required: true,
        enum: AREA_OPTIONS        
    },
    rol: {
        type: [String],           
        required: true,
        default: ['usuario'],   
        enum: ROL_OPTIONS
    },
    activo: {
        type: Boolean,
        default: true             
    },
    permisos: {
        type: [String],           
        default: []
    }
}, {
    timestamps: true
});

module.exports = mongoose.model('UsuariosCA', UsuariosCASchema);


////////////////

